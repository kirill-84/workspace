<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Поиск по многоуровнему списку</title>
</head>
<body>
<input type="text" id="searchInput" placeholder="Поиск...">
<ul id="originalList">
   <li>001
     <ul style="display: none">
       <li>sub directory
         <ul style="display: none">
           <li>last category
             <ul style="display: none">
               <li>Егор</li>
               <li>Пётр</li>
               <li>Алексей</li>
             </ul>
           </li>
         </ul>
       </li>
     </ul>
   </li>
   <li>002
     <ul style="display: none">
       <li>Андрей</li>
       <li>Егор</li>
       <li>Владимир</li>
     </ul>
   </li>
</ul>
<div id="searchResult" style="display: none;">Результатов нет.</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  var originalList = $('#originalList').html(); // Store the original HTML of the list

  $('#searchInput').on('input', function() {
    var searchText = $(this).val().trim().toLowerCase();
    if (searchText.length >= 3) { // Start searching after three letters are entered
      $('#originalList').html(originalList); // Restore the original HTML of the list

      var matchingItems = $('#originalList').find('li:icontains("' + searchText + '")'); // Find matching list items (case-insensitive)

      if (matchingItems.length > 0) {
        // Show matching items and their parent lists
        matchingItems.each(function() {
          $(this).show();
          $(this).parents('li').show();
          $(this).parents('ul').show();
        });

        // Hide non-matching items and their child lists
        $('#originalList').find('li').not(matchingItems).hide();
        $('#originalList').find('li').not(matchingItems).find('ul').hide();

        $('#searchResult').hide(); // Hide the "No results found" message if it was shown previously
      } else {
        $('#originalList').html(''); // Clear the list if no results are found
        $('#searchResult').show(); // Show the "No results found" message
      }
    } else {
      $('#originalList').html(originalList); // Restore the original HTML of the list
      $('#searchResult').hide(); // Hide the "No results found" message
    }
  });

  // Custom jQuery extension for case-insensitive :contains selector
  $.expr[':'].icontains = function(a, i, m) {
    return $(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;
  };
});
</script>

</body>
</html>
